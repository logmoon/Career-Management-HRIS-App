<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Positions</h1>
            <p class="text-gray-600 mt-1">Manage job positions and requirements</p>
        </div>
        <button *ngIf="canCreatePosition()"
                (click)="openCreateModal()"
                class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
            Create New Position
        </button>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Filters</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                <input type="text" 
                       [(ngModel)]="searchText"
                       (input)="applyFilters()"
                       placeholder="Search positions..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                <select [(ngModel)]="selectedDepartment"
                        (change)="applyFilters()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">All Departments</option>
                    <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Level</label>
                <select [(ngModel)]="selectedLevel"
                        (change)="applyFilters()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">All Levels</option>
                    <option *ngFor="let level of levels" [value]="level">{{ level }}</option>
                </select>
            </div>

            <div class="flex items-center space-x-4">
                <label class="flex items-center">
                    <input type="checkbox" 
                           [(ngModel)]="showKeyPositionsOnly"
                           (change)="applyFilters()"
                           class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="ml-2 text-sm text-gray-700">Key positions only</span>
                </label>
            </div>

            <div class="flex items-center space-x-4">
                <label class="flex items-center">
                    <input type="checkbox" 
                           [(ngModel)]="showActiveOnly"
                           (change)="applyFilters()"
                           class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="ml-2 text-sm text-gray-700">Active only</span>
                </label>
            </div>

            <div class="flex space-x-2">
                <button (click)="clearFilters()"
                        class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Clear Filters
                </button>
            </div>
        </div>

        <div class="mt-4 text-sm text-gray-600">
            Showing {{ paginatedPositions.length }} of {{ totalPositions }} positions
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
        <span class="ml-3 text-gray-600">Loading positions...</span>
    </div>

    <!-- Positions Grid -->
    <div *ngIf="!isLoading && paginatedPositions.length > 0" 
         class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let position of paginatedPositions"
             class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow">
            <div class="p-6">
                <!-- Position Header -->
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-1">
                            <a [routerLink]="['/positions', position.id]" 
                               class="hover:text-indigo-600 transition-colors">
                                {{ position.title }}
                            </a>
                        </h3>
                        <p class="text-sm text-gray-600">{{ position.department }} â€¢ {{ position.level }}</p>
                    </div>
                    <span [class]="getPositionStatusClass(position)"
                          class="px-2 py-1 text-xs rounded-full">
                        {{ getPositionStatusText(position) }}
                    </span>
                </div>

                <!-- Position Details -->
                <div class="space-y-2 mb-4">
                    <p *ngIf="position.description" class="text-sm text-gray-700 line-clamp-2">
                        {{ position.description }}
                    </p>
                    
                    <div class="flex items-center text-sm text-gray-600">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                        </svg>
                        {{ formatSalaryRange(position.minSalary, position.maxSalary) }}
                    </div>

                    <div class="flex items-center text-sm text-gray-600">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4m-6 0h6m-6 0v10a1 1 0 001 1h4a1 1 0 001-1V7"/>
                        </svg>
                        {{ position.minYearsExperience }}+ years experience
                    </div>
                </div>

                <!-- Position Stats -->
                <div class="border-t border-gray-200 pt-4">
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-lg font-semibold text-gray-900">{{ position.currentEmployeeCount }}</div>
                            <div class="text-xs text-gray-500">Current Employees</div>
                        </div>
                        <div>
                            <div class="text-lg font-semibold text-gray-900">{{ position.requiredSkillsCount }}</div>
                            <div class="text-xs text-gray-500">Required Skills</div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="border-t border-gray-200 pt-4 mt-4 flex justify-between">
                    <a [routerLink]="['/positions', position.id]"
                       class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                        View Details
                    </a>
                    <button *ngIf="canDeletePosition()"
                            (click)="deletePosition(position.id)"
                            class="text-red-600 hover:text-red-800 text-sm font-medium">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && paginatedPositions.length === 0" 
         class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 48 48">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M8 14v20c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252M8 14c0 4.418 7.163 8 16 8s16-3.582 16-8M8 14c0-4.418 7.163-8 16-8s16 3.582 16 8m0 0v14m-46-4c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252"/>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No positions found</h3>
        <p class="mt-1 text-sm text-gray-500">
            {{ filteredPositions.length === 0 && positions.length > 0 ? 'Try adjusting your filters.' : 'Get started by creating a new position.' }}
        </p>
        <button *ngIf="canCreatePosition() && positions.length === 0"
                (click)="openCreateModal()"
                class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
            Create Position
        </button>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && totalPages > 1" class="flex justify-center items-center space-x-2">
        <button (click)="previousPage()"
                [disabled]="currentPage === 1"
                class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Previous
        </button>
        
        <button *ngFor="let page of pageNumbers"
                (click)="goToPage(page)"
                [class]="page === currentPage ? 'bg-indigo-600 text-white border-indigo-600' : 'text-gray-600 border-gray-300 hover:bg-gray-50'"
                class="px-3 py-2 text-sm border rounded-lg transition-colors">
            {{ page }}
        </button>
        
        <button (click)="nextPage()"
                [disabled]="currentPage === totalPages"
                class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Next
        </button>
    </div>
</div>

<!-- Create Position Modal -->
<div *ngIf="showCreateModal" 
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
     (click)="showCreateModal = false">
    <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
        <h3 class="text-lg font-semibold mb-4">Create New Position</h3>
        
        <div class="flex-1 overflow-y-auto">
            <form [formGroup]="createPositionForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                        <input type="text" 
                               formControlName="title"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                               [class.border-red-500]="createPositionForm.get('title')?.invalid && createPositionForm.get('title')?.touched">
                        <div *ngIf="createPositionForm.get('title')?.invalid && createPositionForm.get('title')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Title is required
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department *</label>
                        <select formControlName="department"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                [class.border-red-500]="createPositionForm.get('department')?.invalid && createPositionForm.get('department')?.touched">
                            <option value="">Select a department</option>
                            <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                        </select>
                        <div *ngIf="createPositionForm.get('department')?.invalid && createPositionForm.get('department')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Department is required
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level *</label>
                        <select formControlName="level"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                [class.border-red-500]="createPositionForm.get('level')?.invalid && createPositionForm.get('level')?.touched">
                            <option value="">Select a level</option>
                            <option *ngFor="let level of levels" [value]="level">{{ level }}</option>
                        </select>
                        <div *ngIf="createPositionForm.get('level')?.invalid && createPositionForm.get('level')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Level is required
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Years Experience *</label>
                        <input type="number" 
                               formControlName="minYearsExperience"
                               min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                               [class.border-red-500]="createPositionForm.get('minYearsExperience')?.invalid && createPositionForm.get('minYearsExperience')?.touched">
                        <div *ngIf="createPositionForm.get('minYearsExperience')?.invalid && createPositionForm.get('minYearsExperience')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Experience must be 0 or greater
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Min Salary</label>
                        <input type="number" 
                               formControlName="minSalary"
                               min="0"
                               step="1000"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                               [class.border-red-500]="createPositionForm.get('minSalary')?.invalid && createPositionForm.get('minSalary')?.touched">
                        <div *ngIf="createPositionForm.get('minSalary')?.invalid && createPositionForm.get('minSalary')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Salary must be positive
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Max Salary</label>
                        <input type="number" 
                               formControlName="maxSalary"
                               min="0"
                               step="1000"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                               [class.border-red-500]="createPositionForm.get('maxSalary')?.invalid && createPositionForm.get('maxSalary')?.touched">
                        <div *ngIf="createPositionForm.get('maxSalary')?.invalid && createPositionForm.get('maxSalary')?.touched" 
                             class="text-red-500 text-xs mt-1">
                            Salary must be positive
                        </div>
                    </div>

                    <div class="md:col-span-2">
                        <div *ngIf="isSalaryRangeInvalid" class="text-red-500 text-sm mt-1">
                            {{ getSalaryRangeErrorMessage() }}
                        </div>
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea formControlName="description"
                                  rows="4"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                  placeholder="Describe the position, responsibilities, and requirements...">
                        </textarea>
                    </div>

                    <div class="md:col-span-2 flex items-center">
                        <label class="flex items-center">
                            <input type="checkbox" 
                                   formControlName="isKeyPosition"
                                   class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-gray-700">This is a key position</span>
                        </label>
                    </div>
                </div>
            </form>
        </div>

        <div class="flex space-x-3 mt-6 pt-4 border-t border-gray-200">
            <button type="button" 
                    (click)="createPosition()"
                    [disabled]="!createPositionForm.valid"
                    class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">
                Create Position
            </button>
            <button type="button" 
                    (click)="showCreateModal = false"
                    class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                Cancel
            </button>
        </div>
    </div>
</div>